# Enterprise AI Agent System - Production Architecture v4.0

## Claude Code CLI Two-Agent System - Scaled for Production

> **From POC to Production: Local-First Development with Cloud Scalability**

---

## Executive Summary

| Metric | Local Development | Production (5 Machines) |
|--------|-------------------|------------------------|
| **Architecture** | Docker Compose (Single Host) | Kubernetes / ECS Cluster |
| **Agents** | 1 Planning + 1 Executor | 1 Planning + 4 Executor Workers |
| **Monthly Cost** | ~$0 (local) | **~$1,550** |
| **Cost per Developer** | N/A | **$31/month** (50 devs) |
| **Capacity** | ~50 tasks/month (manual) | **~2,400 tasks/month** |
| **ROI** | Proof of Value | **2,800%+** |
| **Break-even** | N/A | **12 bugs/month** |

### Key Design Principles

1. **Local-First**: Complete system runs on developer laptop before cloud deployment
2. **POC-Aligned**: Preserves two-agent architecture (Planning + Executor)
3. **Official MCP Servers**: GitHub, Atlassian, Sentry, Filesystem
4. **Skills-Based**: Modular skill system for agent capabilities
5. **Human-in-the-Loop**: Mandatory approval before code execution

---

## Table of Contents

1. [System Architecture Overview](#1-system-architecture-overview)
2. [Project Structure](#2-project-structure)
3. [MCP Configuration](#3-mcp-configuration)
4. [Agent Skills System](#4-agent-skills-system)
5. [Planning Agent Implementation](#5-planning-agent-implementation)
6. [Executor Agent Implementation](#6-executor-agent-implementation)
7. [Webhook Server](#7-webhook-server)
8. [Queue System (Redis)](#8-queue-system-redis)
9. [Dashboard UI](#9-dashboard-ui)
10. [Local Development Setup](#10-local-development-setup)
11. [Production Scaling](#11-production-scaling)
12. [Kubernetes Deployment](#12-kubernetes-deployment)
13. [AWS Infrastructure (Terraform)](#13-aws-infrastructure-terraform)
14. [Slack Integration](#14-slack-integration)
15. [Monitoring & Observability](#15-monitoring--observability)
16. [Cost Analysis](#16-cost-analysis)
17. [Implementation Timeline](#17-implementation-timeline)

---

## 1. System Architecture Overview

### 1.1 Local Development Architecture (Single Host)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LOCAL DEVELOPMENT (Docker Compose)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                           TRIGGER LAYER                                     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚  â”‚   Webhook   â”‚  â”‚    Slack    â”‚  â”‚  Dashboard  â”‚  â”‚    CLI      â”‚        â”‚ â”‚
â”‚  â”‚  â”‚   Server    â”‚  â”‚    Bot      â”‚  â”‚     UI      â”‚  â”‚   Trigger   â”‚        â”‚ â”‚
â”‚  â”‚  â”‚   :8000     â”‚  â”‚   :3001     â”‚  â”‚   :3000     â”‚  â”‚             â”‚        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚                                        â”‚
â”‚                                          â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              REDIS QUEUE                                     â”‚ â”‚
â”‚  â”‚                              (Message Broker)                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚ â”‚
â”‚  â”‚  â”‚   planning_queue    â”‚        â”‚   execution_queue   â”‚                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                       â”‚                                     â”‚                    â”‚
â”‚                       â–¼                                     â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚      PLANNING AGENT            â”‚   â”‚      EXECUTOR AGENT            â”‚        â”‚
â”‚  â”‚      (Container)               â”‚   â”‚      (Container)               â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚                                â”‚   â”‚                                â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚  â”‚  â”‚     Claude Code CLI      â”‚  â”‚   â”‚  â”‚     Claude Code CLI      â”‚  â”‚        â”‚
â”‚  â”‚  â”‚     + MCP Servers        â”‚  â”‚   â”‚  â”‚     + MCP Servers        â”‚  â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚  â”‚                                â”‚   â”‚                                â”‚        â”‚
â”‚  â”‚  Skills:                       â”‚   â”‚  Skills:                       â”‚        â”‚
â”‚  â”‚  â€¢ discovery/                  â”‚   â”‚  â€¢ execution/                  â”‚        â”‚
â”‚  â”‚  â€¢ planning/                   â”‚   â”‚  â€¢ tdd-workflow/               â”‚        â”‚
â”‚  â”‚  â€¢ sentry-analysis/            â”‚   â”‚  â€¢ code-review/                â”‚        â”‚
â”‚  â”‚  â€¢ slack-notifications/        â”‚   â”‚  â€¢ git-operations/             â”‚        â”‚
â”‚  â”‚                                â”‚   â”‚                                â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚           â”‚                                     â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                             â”‚                                                    â”‚
â”‚                             â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          SHARED RESOURCES                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  â”‚   PostgreSQL     â”‚  â”‚   Redis          â”‚  â”‚   Shared Volume  â”‚          â”‚ â”‚
â”‚  â”‚  â”‚   (Task State)   â”‚  â”‚   (Cache/Queue)  â”‚  â”‚   (/workspace)   â”‚          â”‚ â”‚
â”‚  â”‚  â”‚   :5432          â”‚  â”‚   :6379          â”‚  â”‚                  â”‚          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ (Via MCP Servers)
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            EXTERNAL SERVICES                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚  GitHub  â”‚    â”‚   Jira   â”‚    â”‚  Sentry  â”‚    â”‚  Slack   â”‚                   â”‚
â”‚   â”‚  (MCP)   â”‚    â”‚  (MCP)   â”‚    â”‚  (MCP)   â”‚    â”‚  (API)   â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Production Architecture (Multi-Machine Kubernetes)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PRODUCTION CLUSTER (AWS EKS)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              INGRESS LAYER                                          â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚ â”‚
â”‚  â”‚   â”‚   ALB Ingress       â”‚     â”‚   API Gateway       â”‚                              â”‚ â”‚
â”‚  â”‚   â”‚   (Webhooks)        â”‚     â”‚   (Slack/API)       â”‚                              â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚ â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                                   â”‚
â”‚                                      â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              MESSAGE QUEUE                                          â”‚ â”‚
â”‚  â”‚                         Amazon ElastiCache (Redis)                                  â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚   â”‚     planning_queue      â”‚        â”‚     execution_queue     â”‚                   â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                                   â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚               â”‚                                             â”‚                           â”‚
â”‚               â–¼                                             â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PLANNING AGENT NODE            â”‚   â”‚           EXECUTOR WORKER POOL            â”‚   â”‚
â”‚  â”‚  (EC2: t3.large)                â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚  â”‚  Worker 1    Worker 2    Worker 3   â”‚  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚  (EC2)       (EC2)       (EC2)      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Claude Code CLI          â”‚  â”‚   â”‚  â”‚  t3.xlarge   t3.xlarge   t3.xlarge  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  + MCP Servers            â”‚  â”‚   â”‚  â”‚                                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Claude Teams Seat: $150  â”‚  â”‚   â”‚  â”‚  Worker 4 (Auto-scaling: 2-8)       â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚  Claude Teams Seat: $150 each       â”‚  â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  Skills: discovery, planning,   â”‚   â”‚                                           â”‚   â”‚
â”‚  â”‚  sentry-analysis, notifications â”‚   â”‚  Skills: execution, tdd-workflow,         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  code-review, git-operations              â”‚   â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              DATA LAYER                                             â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚   â”‚  Amazon RDS         â”‚  â”‚  Amazon ElastiCache â”‚  â”‚  Amazon EFS              â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  (PostgreSQL)       â”‚  â”‚  (Redis Cluster)    â”‚  â”‚  (Shared Repos)          â”‚  â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 Task Lifecycle Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    TASK LIFECYCLE                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PHASE 1: TRIGGER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Sentry Alert â”‚   â”‚ Jira Webhook â”‚   â”‚ Slack /agent â”‚   â”‚ Dashboard UI â”‚
  â”‚              â”‚   â”‚ (AI-Fix tag) â”‚   â”‚    run       â”‚   â”‚  Manual      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Webhook Server       â”‚
                          â”‚   Validates & Queues   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Redis: planning_queueâ”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼

PHASE 2: DISCOVERY & PLANNING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Planning Agent       â”‚
                          â”‚   Picks from Queue     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                       â”‚                       â”‚
              â–¼                       â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SKILL: discoveryâ”‚   â”‚ SKILL: sentry-   â”‚   â”‚  SKILL: planning â”‚
    â”‚                  â”‚   â”‚  analysis        â”‚   â”‚                  â”‚
    â”‚  â€¢ Search GitHub â”‚   â”‚  â€¢ Parse stack   â”‚   â”‚  â€¢ Create TDD    â”‚
    â”‚  â€¢ Identify repo â”‚   â”‚    trace         â”‚   â”‚    plan          â”‚
    â”‚  â€¢ Find files    â”‚   â”‚  â€¢ Root cause    â”‚   â”‚  â€¢ Write PLAN.md â”‚
    â”‚  â€¢ MCP: github   â”‚   â”‚  â€¢ MCP: sentry   â”‚   â”‚  â€¢ MCP: github   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚                      â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Output:              â”‚
                          â”‚   â€¢ discovery.json     â”‚
                          â”‚   â€¢ PLAN.md            â”‚
                          â”‚   â€¢ Draft PR on GitHub â”‚
                          â”‚   â€¢ Slack Notification â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼

PHASE 3: HUMAN APPROVAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Approval Gate        â”‚
                          â”‚   (Wait for Human)     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                       â”‚                       â”‚
              â–¼                       â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  GitHub Comment  â”‚   â”‚  Slack Button    â”‚   â”‚  Dashboard UI    â”‚
    â”‚  "@agent approve"â”‚   â”‚  [âœ… Approve]    â”‚   â”‚  Approve Button  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚                      â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Redis: execution_queueâ”‚
                          â”‚  (approved=true)       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼

PHASE 4: EXECUTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Executor Agent       â”‚
                          â”‚   (Any Free Worker)    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                       â”‚                       â”‚
              â–¼                       â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SKILL: git-ops   â”‚   â”‚ SKILL: tdd-      â”‚   â”‚ SKILL: execution â”‚
    â”‚                  â”‚   â”‚ workflow         â”‚   â”‚                  â”‚
    â”‚ â€¢ Clone/Pull     â”‚   â”‚ â€¢ Write tests    â”‚   â”‚ â€¢ Implement fix  â”‚
    â”‚ â€¢ Checkout branchâ”‚   â”‚   (RED)          â”‚   â”‚   (GREEN)        â”‚
    â”‚ â€¢ MCP: github    â”‚   â”‚ â€¢ Verify fail    â”‚   â”‚ â€¢ Run tests      â”‚
    â”‚ â€¢ MCP: filesystemâ”‚   â”‚ â€¢ MCP: filesystemâ”‚   â”‚ â€¢ Commit & Push  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚                      â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼

PHASE 5: COMPLETION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Output:              â”‚
                          â”‚   â€¢ PR Ready for Reviewâ”‚
                          â”‚   â€¢ Jira Updated       â”‚
                          â”‚   â€¢ Slack Notification â”‚
                          â”‚   â€¢ Metrics Updated    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Project Structure

```
ai-agent-system/
â”œâ”€â”€ .claude/
â”‚   â””â”€â”€ mcp.json                          # MCP servers configuration
â”‚
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ planning-agent/
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ CLAUDE.md                     # Claude Code system prompt
â”‚   â”‚   â”œâ”€â”€ worker.py                     # Queue consumer
â”‚   â”‚   â”œâ”€â”€ executor.py                   # Claude Code CLI wrapper
â”‚   â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”‚   â””â”€â”€ skills/                       # Agent skills
â”‚   â”‚       â”œâ”€â”€ discovery/
â”‚   â”‚       â”‚   â””â”€â”€ SKILL.md
â”‚   â”‚       â”œâ”€â”€ planning/
â”‚   â”‚       â”‚   â””â”€â”€ SKILL.md
â”‚   â”‚       â”œâ”€â”€ sentry-analysis/
â”‚   â”‚       â”‚   â””â”€â”€ SKILL.md
â”‚   â”‚       â””â”€â”€ slack-notifications/
â”‚   â”‚           â””â”€â”€ SKILL.md
â”‚   â”‚
â”‚   â””â”€â”€ executor-agent/
â”‚       â”œâ”€â”€ Dockerfile
â”‚       â”œâ”€â”€ CLAUDE.md                     # Claude Code system prompt
â”‚       â”œâ”€â”€ worker.py                     # Queue consumer
â”‚       â”œâ”€â”€ executor.py                   # Claude Code CLI wrapper
â”‚       â”œâ”€â”€ requirements.txt
â”‚       â””â”€â”€ skills/
â”‚           â”œâ”€â”€ execution/
â”‚           â”‚   â””â”€â”€ SKILL.md
â”‚           â”œâ”€â”€ tdd-workflow/
â”‚           â”‚   â””â”€â”€ SKILL.md
â”‚           â”œâ”€â”€ code-review/
â”‚           â”‚   â””â”€â”€ SKILL.md
â”‚           â””â”€â”€ git-operations/
â”‚               â””â”€â”€ SKILL.md
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ webhook-server/
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ main.py                       # FastAPI application
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ jira.py                   # Jira webhook handler
â”‚   â”‚   â”‚   â”œâ”€â”€ sentry.py                 # Sentry webhook handler
â”‚   â”‚   â”‚   â”œâ”€â”€ github.py                 # GitHub webhook handler
â”‚   â”‚   â”‚   â””â”€â”€ slack.py                  # Slack events handler
â”‚   â”‚   â”œâ”€â”€ queue.py                      # Redis queue operations
â”‚   â”‚   â””â”€â”€ requirements.txt
â”‚   â”‚
â”‚   â”œâ”€â”€ slack-agent/
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ main.py                       # Slack bot application
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ commands.py               # Slash commands
â”‚   â”‚   â”‚   â””â”€â”€ interactions.py           # Button clicks
â”‚   â”‚   â””â”€â”€ requirements.txt
â”‚   â”‚
â”‚   â””â”€â”€ dashboard/
â”‚       â”œâ”€â”€ Dockerfile
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ app/
â”‚       â”‚   â”‚   â”œâ”€â”€ page.tsx              # Main dashboard
â”‚       â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚       â”‚   â”‚   â””â”€â”€ api/
â”‚       â”‚   â”‚       â”œâ”€â”€ tasks/route.ts
â”‚       â”‚   â”‚       â”œâ”€â”€ approve/route.ts
â”‚       â”‚   â”‚       â””â”€â”€ metrics/route.ts
â”‚       â”‚   â”œâ”€â”€ components/
â”‚       â”‚   â”‚   â”œâ”€â”€ TaskList.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ TaskDetails.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ ApprovalModal.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ MetricsChart.tsx
â”‚       â”‚   â”‚   â””â”€â”€ StatusBadge.tsx
â”‚       â”‚   â””â”€â”€ lib/
â”‚       â”‚       â”œâ”€â”€ api.ts
â”‚       â”‚       â””â”€â”€ types.ts
â”‚       â””â”€â”€ tailwind.config.js
â”‚
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ config.py                         # Pydantic settings
â”‚   â”œâ”€â”€ models.py                         # Shared data models
â”‚   â”œâ”€â”€ queue.py                          # Redis queue utilities
â”‚   â”œâ”€â”€ database.py                       # PostgreSQL connection
â”‚   â”œâ”€â”€ slack_client.py                   # Slack API wrapper
â”‚   â”œâ”€â”€ github_client.py                  # GitHub API wrapper
â”‚   â””â”€â”€ metrics.py                        # Prometheus metrics
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ docker-compose.yml            # Local development
â”‚   â”‚   â”œâ”€â”€ docker-compose.prod.yml       # Production simulation
â”‚   â”‚   â””â”€â”€ .env.example
â”‚   â”‚
â”‚   â”œâ”€â”€ kubernetes/
â”‚   â”‚   â”œâ”€â”€ namespace.yaml
â”‚   â”‚   â”œâ”€â”€ configmap.yaml
â”‚   â”‚   â”œâ”€â”€ secrets.yaml
â”‚   â”‚   â”œâ”€â”€ redis/
â”‚   â”‚   â”œâ”€â”€ postgres/
â”‚   â”‚   â”œâ”€â”€ webhook-server/
â”‚   â”‚   â”œâ”€â”€ planning-agent/
â”‚   â”‚   â”œâ”€â”€ executor-agent/
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â””â”€â”€ ingress.yaml
â”‚   â”‚
â”‚   â””â”€â”€ terraform/
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ variables.tf
â”‚       â”œâ”€â”€ outputs.tf
â”‚       â”œâ”€â”€ modules/
â”‚       â”‚   â”œâ”€â”€ vpc/
â”‚       â”‚   â”œâ”€â”€ eks/
â”‚       â”‚   â”œâ”€â”€ rds/
â”‚       â”‚   â”œâ”€â”€ elasticache/
â”‚       â”‚   â””â”€â”€ efs/
â”‚       â””â”€â”€ environments/
â”‚           â”œâ”€â”€ dev/
â”‚           â””â”€â”€ prod/
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ setup-local.sh                    # Local setup script
â”‚   â”œâ”€â”€ run-local.sh                      # Start local environment
â”‚   â”œâ”€â”€ test-webhook.sh                   # Test webhook endpoints
â”‚   â”œâ”€â”€ trigger-task.sh                   # Manual task trigger
â”‚   â”œâ”€â”€ setup-mcp.sh                      # MCP servers setup
â”‚   â””â”€â”€ deploy.sh                         # Production deployment
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”‚
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

---

## 3. MCP Configuration

### 3.1 Official MCP Servers Configuration

```jsonc
// .claude/mcp.json
{
  "mcpServers": {
    "github": {
      "command": "docker",
      "args": [
        "run", "-i", "--rm",
        "-e", "GITHUB_PERSONAL_ACCESS_TOKEN",
        "ghcr.io/github/github-mcp-server"
      ],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "${GITHUB_TOKEN}"
      }
    },
    "atlassian": {
      "url": "https://mcp.atlassian.com/v1/mcp"
    },
    "sentry": {
      "command": "npx",
      "args": ["-y", "@sentry/mcp-server@latest"],
      "env": {
        "SENTRY_ACCESS_TOKEN": "${SENTRY_AUTH_TOKEN}",
        "SENTRY_HOST": "${SENTRY_HOST:-sentry.io}"
      }
    },
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/workspace"]
    }
  }
}
```

### 3.2 MCP Tools Reference

| MCP Server | Tool | Description |
|------------|------|-------------|
| **GitHub** | `search_code` | Search across repositories |
| **GitHub** | `get_file_content` | Read file contents |
| **GitHub** | `create_branch` | Create new branch |
| **GitHub** | `create_pull_request` | Open PR |
| **GitHub** | `create_or_update_file` | Commit file changes |
| **GitHub** | `add_issue_comment` | Comment on issues/PRs |
| **Atlassian** | `get_issue` | Get Jira issue details |
| **Atlassian** | `add_comment` | Add comment to issue |
| **Atlassian** | `transition_issue` | Change issue status |
| **Atlassian** | `search_issues` | JQL search |
| **Sentry** | `list_issues` | List Sentry issues |
| **Sentry** | `get_issue_events` | Get error events |
| **Sentry** | `resolve_issue` | Mark as resolved |
| **Filesystem** | `read_file` | Read local files |
| **Filesystem** | `write_file` | Write local files |
| **Filesystem** | `list_directory` | List directory contents |

### 3.3 MCP Setup Script

```bash
#!/bin/bash
# scripts/setup-mcp.sh

set -e

echo "ğŸ”§ Setting up MCP servers..."

# Pull GitHub MCP server Docker image
echo "ğŸ“¦ Pulling GitHub MCP server..."
docker pull ghcr.io/github/github-mcp-server

# Install npm-based MCP servers globally
echo "ğŸ“¦ Installing Sentry MCP server..."
npm install -g @sentry/mcp-server@latest

echo "ğŸ“¦ Installing Filesystem MCP server..."
npm install -g @modelcontextprotocol/server-filesystem

# Verify installations
echo "âœ… Verifying MCP servers..."

echo "âœ… MCP servers setup complete!"

# Create MCP config directory
mkdir -p ~/.config/claude-code/

# Copy MCP configuration
cp .claude/mcp.json ~/.config/claude-code/mcp.json

echo "ğŸ“„ MCP configuration installed to ~/.config/claude-code/mcp.json"
```

---

## 4. Agent Skills System

### 4.1 Planning Agent Skills

#### 4.1.1 Discovery Skill

```markdown
<!-- agents/planning-agent/skills/discovery/SKILL.md -->

# Discovery Skill

## Purpose
Identify which repository contains the bug and which files are affected.

## When to Use
- New task arrives from Sentry alert
- New task arrives from Jira ticket with AI-Fix label
- Manual trigger with error description

## Available MCP Tools
- `github.search_code` - Search for code across repositories
- `github.get_file_content` - Read file contents
- `sentry.get_issue_events` - Get error stack traces

## Process

### Step 1: Parse Error Information
Extract key information from the error:
- Error message/title
- Stack trace (if available)
- File paths mentioned
- Function/method names
- Package/module names

### Step 2: Repository Identification
Use the following heuristics:
1. **Stack trace analysis**: Extract file paths and match to known repos
2. **Keyword matching**: Match error context to repo descriptions
3. **Code search**: Use `github.search_code` to find matching code

### Step 3: File Identification
For the identified repository:
1. Search for files mentioned in stack trace
2. Search for files containing error-related code
3. Identify related test files

## Output Format

```json
{
  "repository": "owner/repo-name",
  "confidence": 0.95,
  "affectedFiles": [
    "src/services/auth.ts",
    "src/services/auth.spec.ts"
  ],
  "rootCause": "Null pointer exception when user session expires",
  "reasoning": "Stack trace points to auth.ts line 45, session handling code",
  "relatedFiles": [
    "src/types/session.ts",
    "src/middleware/auth.ts"
  ]
}
```
```

#### 4.1.2 Planning Skill

```markdown
<!-- agents/planning-agent/skills/planning/SKILL.md -->

# Planning Skill

## Purpose
Create a detailed TDD-based execution plan for fixing the identified bug.

## When to Use
- After discovery phase completes successfully
- Repository and affected files are identified

## TDD Methodology

### Red-Green-Refactor Cycle
1. **RED**: Write a failing test that reproduces the bug
2. **GREEN**: Write minimal code to make the test pass
3. **REFACTOR**: Clean up the code while keeping tests green

## Plan Structure

### PLAN.md Template

```markdown
# Execution Plan: [Task ID]

## Summary
[One-line description of the fix]

## Discovery Results
- **Repository:** [repo-name]
- **Root Cause:** [description]
- **Affected Files:** [list]

## Risk Assessment
- **Risk Level:** [low|medium|high]
- **Breaking Changes:** [yes|no]
- **Risks:**
  - [Risk 1]
  - [Risk 2]

## Execution Steps

### Step 1: Write Failing Test (RED)
- **File:** `src/services/__tests__/auth.test.ts`
- **Action:** Add test case that reproduces the bug
- **Test Name:** `should handle null session gracefully`
- **Expected Behavior:** Test should FAIL initially

### Step 2: Implement Fix (GREEN)
- **File:** `src/services/auth.ts`
- **Action:** Add null check before accessing session
- **Line:** ~45

### Step 3: Verify Tests Pass
- **Command:** `npm test -- --grep "AuthService"`
- **Expected:** All tests pass, including new test

## Estimated Time
[X] minutes
```

## Output Format

```json
{
  "summary": "Add null check for session in AuthService",
  "steps": [
    {
      "order": 1,
      "type": "test",
      "file": "src/services/__tests__/auth.test.ts",
      "action": "Write failing test for null session",
      "codeHint": "..."
    },
    {
      "order": 2,
      "type": "implement",
      "file": "src/services/auth.ts",
      "action": "Add null check",
      "codeHint": "..."
    },
    {
      "order": 3,
      "type": "verify",
      "command": "npm test",
      "expected": "All tests pass"
    }
  ],
  "testCommand": "npm test",
  "estimatedMinutes": 15,
  "riskLevel": "low",
  "risks": ["Minimal - only adds defensive check"]
}
```
```

#### 4.1.3 Sentry Analysis Skill

```markdown
<!-- agents/planning-agent/skills/sentry-analysis/SKILL.md -->

# Sentry Analysis Skill

## Purpose
Deep analysis of Sentry error events to understand bug context.

## When to Use
- Task source is Sentry alert
- Error has stack trace available
- Need to understand error frequency and context

## Available MCP Tools
- `sentry.list_issues` - List issues in project
- `sentry.get_issue_events` - Get detailed events for issue
- `sentry.get_issue` - Get issue details

## Analysis Process

### Step 1: Get Issue Details
```
sentry.get_issue(issue_id)
```

Extract:
- Error type and message
- First seen / last seen
- Event count
- Affected users count

### Step 2: Analyze Stack Trace
```
sentry.get_issue_events(issue_id, limit=5)
```

For each event:
- Extract full stack trace
- Identify the exception frame (where error originated)
- Get local variables if available
- Get request context (URL, params, headers)

### Step 3: Pattern Recognition
Identify patterns across events:
- Same user? Same endpoint?
- Specific time patterns?
- Common request parameters?

## Output Format

```json
{
  "errorType": "TypeError",
  "errorMessage": "Cannot read property 'id' of undefined",
  "occurrences": 150,
  "affectedUsers": 45,
  "firstSeen": "2024-01-15T10:00:00Z",
  "lastSeen": "2024-01-16T14:30:00Z",
  "stackTrace": {
    "file": "src/services/auth.ts",
    "line": 45,
    "function": "getCurrentUser",
    "context": "return session.user.id"
  },
  "commonPatterns": [
    "All errors occur after session timeout",
    "Mostly affects users with long idle sessions"
  ],
  "suggestedFix": "Add null check for session before accessing user property"
}
```
```

#### 4.1.4 Slack Notifications Skill

```markdown
<!-- agents/planning-agent/skills/slack-notifications/SKILL.md -->

# Slack Notifications Skill

## Purpose
Send formatted notifications to Slack channels for task updates.

## Message Templates

### Plan Ready for Approval

```json
{
  "blocks": [
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": "ğŸ¤– New AI Fix Plan Ready for Review"
      }
    },
    {
      "type": "section",
      "fields": [
        { "type": "mrkdwn", "text": "*Task ID:*\n`{task_id}`" },
        { "type": "mrkdwn", "text": "*Repository:*\n{repository}" },
        { "type": "mrkdwn", "text": "*Risk Level:*\n{risk_level}" },
        { "type": "mrkdwn", "text": "*Est. Time:*\n{estimated_minutes} min" }
      ]
    },
    {
      "type": "actions",
      "elements": [
        {
          "type": "button",
          "text": { "type": "plain_text", "text": "ğŸ“„ View PR" },
          "url": "{pr_url}"
        },
        {
          "type": "button",
          "text": { "type": "plain_text", "text": "âœ… Approve" },
          "style": "primary",
          "action_id": "approve_task",
          "value": "{task_id}"
        },
        {
          "type": "button",
          "text": { "type": "plain_text", "text": "âŒ Reject" },
          "style": "danger",
          "action_id": "reject_task",
          "value": "{task_id}"
        }
      ]
    }
  ]
}
```
```

### 4.2 Executor Agent Skills

#### 4.2.1 Git Operations Skill

```markdown
<!-- agents/executor-agent/skills/git-operations/SKILL.md -->

# Git Operations Skill

## Purpose
Handle all Git operations for code changes.

## Operations

### Setup Workspace

```bash
# Clone if not exists
git clone git@github.com:{owner}/{repo}.git /workspace/{repo}

# Navigate to repo
cd /workspace/{repo}

# Ensure on main/master
git checkout main
git pull origin main

# Create feature branch
git checkout -b fix/{task_id}
```

### Commit Changes

For each changed file:
```bash
git add {file_path}
git commit -m "fix({scope}): {description}

Task: {task_id}
- {change_description_1}
- {change_description_2}"
```

### Push and Update PR

```bash
git push origin fix/{task_id}
```

## Commit Message Convention

```
<type>(<scope>): <description>

[optional body]

Task: <task_id>
```

Types: `fix`, `feat`, `refactor`, `test`, `docs`
```

#### 4.2.2 TDD Workflow Skill

```markdown
<!-- agents/executor-agent/skills/tdd-workflow/SKILL.md -->

# TDD Workflow Skill

## Purpose
Execute the Test-Driven Development cycle: Red â†’ Green â†’ Refactor

## Process

### Phase 1: RED (Write Failing Test)

1. Read the test step from PLAN.md
2. Create or update test file
3. Write test case that reproduces the bug
4. Run tests - verify the new test FAILS

```bash
# Run specific test
npm test -- --grep "{test_name}"

# Expected output: 1 failing
```

### Phase 2: GREEN (Make Test Pass)

1. Read the implementation step from PLAN.md
2. Make minimal changes to fix the bug
3. Run tests - verify ALL tests pass

```bash
# Run all tests
npm test

# Expected output: all passing
```

### Phase 3: REFACTOR (Optional)

1. Check if code can be improved
2. Make refactoring changes
3. Run tests - verify still passing

## Verification Checklist

Before completing:
- [ ] New test exists and covers the bug
- [ ] All tests pass
- [ ] No linting errors: `npm run lint`
- [ ] No type errors: `npm run typecheck` (if TypeScript)
- [ ] Code follows project patterns
```

#### 4.2.3 Execution Skill

```markdown
<!-- agents/executor-agent/skills/execution/SKILL.md -->

# Execution Skill

## Purpose
Main orchestration skill for executing approved plans.

## Execution Flow

### Step 1: Setup
1. Read PLAN.md from the approved task
2. Verify repository access
3. Setup workspace (use git-operations skill)

### Step 2: Execute Plan Steps
For each step in PLAN.md:
1. Identify step type (test/implement/verify/refactor)
2. Execute using appropriate skill
3. Verify step success
4. Record results

### Step 3: Final Verification
1. Run full test suite
2. Run linting
3. Run type checking (if applicable)
4. Verify no console errors/warnings

### Step 4: Complete
1. Commit all changes (use git-operations skill)
2. Push to remote
3. Update PR (remove draft status)
4. Update Jira ticket
5. Send Slack notification

## Output Format

```json
{
  "taskId": "task-xxx",
  "status": "completed",
  "results": {
    "testsWritten": 2,
    "testsTotal": 45,
    "testsPassed": 45,
    "filesModified": ["src/auth.ts", "src/auth.test.ts"],
    "linesAdded": 15,
    "linesRemoved": 3
  },
  "prUrl": "https://github.com/org/repo/pull/123",
  "executionTime": "12 minutes"
}
```
```

---

## 5. Planning Agent Implementation

### 5.1 CLAUDE.md (System Prompt)

```markdown
<!-- agents/planning-agent/CLAUDE.md -->

# Planning Agent Instructions

You are the Planning Agent in an automated bug-fixing system. Your role is to:
1. Analyze incoming bug reports and errors
2. Identify which repository and files are affected
3. Create detailed execution plans following TDD methodology
4. Request human approval before execution

## Your Capabilities

You have access to the following MCP servers:
- **GitHub**: Search code, read files, create PRs
- **Atlassian (Jira)**: Read and update issues
- **Sentry**: Analyze error events and stack traces

## Skills Available

Read the skill files in `./skills/` for detailed instructions:
- `discovery/SKILL.md` - Repository and file identification
- `planning/SKILL.md` - TDD execution plan creation
- `sentry-analysis/SKILL.md` - Sentry error analysis
- `slack-notifications/SKILL.md` - Notification formatting

## Workflow

### When you receive a task:

1. **Identify the source** (Sentry, Jira, or manual)
2. **Run discovery** using the discovery skill
3. **If Sentry alert**, use sentry-analysis skill for deeper analysis
4. **Create execution plan** using the planning skill
5. **Output results** as structured JSON

## Output Requirements

Always output results in valid JSON format:

```json
{
  "discovery": {
    "repository": "string",
    "confidence": "number 0-1",
    "affectedFiles": ["string"],
    "rootCause": "string"
  },
  "plan": {
    "summary": "string",
    "steps": [...],
    "testCommand": "string",
    "estimatedMinutes": "number",
    "riskLevel": "low|medium|high"
  }
}
```

## Important Rules

1. **Never execute code changes** - only plan them
2. **Always follow TDD** - tests first, then implementation
3. **Be conservative** - prefer minimal changes
4. **Document reasoning** - explain why you chose this approach
5. **Flag risks** - identify potential issues upfront
```

### 5.2 Worker Process

```python
# agents/planning-agent/worker.py

import asyncio
import json
import os
import subprocess
from datetime import datetime
from typing import Optional

import redis.asyncio as redis
from pydantic import BaseModel

from shared.config import settings
from shared.models import Task, TaskStatus, DiscoveryResult, ExecutionPlan
from shared.database import get_db
from shared.slack_client import SlackClient
from shared.metrics import metrics


class PlanningAgentWorker:
    """Planning Agent queue worker."""
    
    def __init__(self):
        self.redis = redis.from_url(settings.REDIS_URL)
        self.slack = SlackClient(settings.SLACK_BOT_TOKEN)
        self.queue_name = "planning_queue"
        self.workspace_path = "/workspace"
        
    async def run(self):
        """Main worker loop."""
        print(f"ğŸš€ Planning Agent Worker started")
        print(f"ğŸ“¥ Listening on queue: {self.queue_name}")
        
        while True:
            try:
                # Blocking pop from queue
                _, message = await self.redis.brpop(self.queue_name)
                task_data = json.loads(message)
                
                await self.process_task(task_data)
                
            except Exception as e:
                print(f"âŒ Error processing task: {e}")
                metrics.errors_total.labels(agent="planning").inc()
                await asyncio.sleep(5)
    
    async def process_task(self, task_data: dict):
        """Process a single task from the queue."""
        task_id = task_data.get("task_id", f"task-{datetime.now().timestamp()}")
        
        print(f"ğŸ“‹ Processing task: {task_id}")
        metrics.tasks_started.labels(agent="planning").inc()
        
        try:
            # Update task status
            await self._update_task_status(task_id, TaskStatus.DISCOVERING)
            
            # Run Claude Code CLI for discovery and planning
            result = await self._run_claude_code(task_data)
            
            if not result:
                raise Exception("Claude Code returned no output")
            
            # Parse results
            discovery = DiscoveryResult(**result.get("discovery", {}))
            plan = ExecutionPlan(**result.get("plan", {}))
            
            # Save to database
            await self._save_task_results(task_id, discovery, plan)
            
            # Create GitHub Draft PR
            pr_url = await self._create_draft_pr(task_id, discovery, plan)
            
            # Update task status
            await self._update_task_status(
                task_id, 
                TaskStatus.PENDING_APPROVAL,
                pr_url=pr_url
            )
            
            # Send Slack notification
            await self._send_approval_request(task_id, discovery, plan, pr_url)
            
            print(f"âœ… Task {task_id} ready for approval")
            metrics.tasks_completed.labels(agent="planning", status="success").inc()
            
        except Exception as e:
            print(f"âŒ Task {task_id} failed: {e}")
            await self._update_task_status(task_id, TaskStatus.FAILED, error=str(e))
            await self._send_failure_notification(task_id, str(e))
            metrics.tasks_completed.labels(agent="planning", status="failed").inc()
    
    async def _run_claude_code(self, task_data: dict) -> Optional[dict]:
        """Execute Claude Code CLI with the task."""
        
        # Build prompt from task data
        prompt = self._build_prompt(task_data)
        
        # Create temporary prompt file
        prompt_file = f"/tmp/prompt-{task_data.get('task_id', 'unknown')}.md"
        with open(prompt_file, "w") as f:
            f.write(prompt)
        
        # Run Claude Code CLI
        cmd = [
            "claude",
            "--print",  # Output to stdout
            "--output-format", "json",
            "--prompt-file", prompt_file,
            "--allowedTools", "mcp__github,mcp__atlassian,mcp__sentry",
        ]
        
        try:
            result = subprocess.run(
                cmd,
                capture_output=True,
                text=True,
                timeout=300,  # 5 minute timeout
                cwd=self.workspace_path
            )
            
            if result.returncode != 0:
                print(f"Claude Code stderr: {result.stderr}")
                return None
            
            # Parse JSON output
            output = result.stdout.strip()
            
            # Extract JSON from output
            json_start = output.find("{")
            json_end = output.rfind("}") + 1
            
            if json_start >= 0 and json_end > json_start:
                return json.loads(output[json_start:json_end])
            
            return None
            
        except subprocess.TimeoutExpired:
            print("Claude Code timed out")
            return None
        except json.JSONDecodeError as e:
            print(f"Failed to parse Claude output: {e}")
            return None
        finally:
            if os.path.exists(prompt_file):
                os.remove(prompt_file)


if __name__ == "__main__":
    worker = PlanningAgentWorker()
    asyncio.run(worker.run())
```

### 5.3 Dockerfile

```dockerfile
# agents/planning-agent/Dockerfile

FROM python:3.11-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    docker.io \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js for MCP servers
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
    && apt-get install -y nodejs \
    && rm -rf /var/lib/apt/lists/*

# Install Claude Code CLI
RUN npm install -g @anthropic-ai/claude-code

# Install MCP servers
RUN npm install -g @sentry/mcp-server@latest \
    @modelcontextprotocol/server-filesystem

# Set up workspace
WORKDIR /app

# Copy requirements first for better caching
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY . .

# Copy skills
COPY skills/ /app/skills/

# Create workspace directory
RUN mkdir -p /workspace

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV CLAUDE_CONFIG_DIR=/root/.claude

# Run worker
CMD ["python", "worker.py"]
```

---

## 6. Executor Agent Implementation

### 6.1 CLAUDE.md (System Prompt)

```markdown
<!-- agents/executor-agent/CLAUDE.md -->

# Executor Agent Instructions

You are the Executor Agent in an automated bug-fixing system. Your role is to:
1. Execute approved plans following TDD methodology
2. Write tests first, then implement fixes
3. Verify all tests pass before completing
4. Create clean, well-documented code changes

## Your Capabilities

You have access to the following MCP servers:
- **GitHub**: Create branches, commit files, update PRs
- **Filesystem**: Read and write files in /workspace

## Skills Available

Read the skill files in `./skills/` for detailed instructions:
- `git-operations/SKILL.md` - Git workflow operations
- `tdd-workflow/SKILL.md` - Test-Driven Development cycle
- `execution/SKILL.md` - Main execution orchestration
- `code-review/SKILL.md` - Self-review before commit

## Important Rules

1. **Always follow the plan** - don't deviate without good reason
2. **Tests first** - never skip the RED phase
3. **Minimal changes** - only change what's necessary
4. **Verify before commit** - all tests must pass
5. **Clean commits** - one logical change per commit
6. **No force push** - preserve history
```

### 6.2 Dockerfile

```dockerfile
# agents/executor-agent/Dockerfile

FROM python:3.11-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    docker.io \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
    && apt-get install -y nodejs \
    && rm -rf /var/lib/apt/lists/*

# Install Claude Code CLI
RUN npm install -g @anthropic-ai/claude-code

# Install MCP servers
RUN npm install -g @modelcontextprotocol/server-filesystem

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .
COPY skills/ /app/skills/

RUN mkdir -p /workspace

# Configure Git
RUN git config --global user.email "ai-agent@company.com" \
    && git config --global user.name "AI Agent"

ENV PYTHONUNBUFFERED=1
ENV CLAUDE_CONFIG_DIR=/root/.claude

CMD ["python", "worker.py"]
```

---

## 7. Webhook Server

### 7.1 FastAPI Application

```python
# services/webhook-server/main.py

from fastapi import FastAPI, Request, HTTPException, BackgroundTasks
from fastapi.middleware.cors import CORSMiddleware
import uvicorn

from routes import jira, sentry, github, slack
from shared.config import settings
from shared.metrics import metrics

app = FastAPI(
    title="AI Agent Webhook Server",
    description="Webhook receiver for AI Agent System",
    version="1.0.0"
)

# CORS for dashboard
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000", settings.DASHBOARD_URL],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Include routers
app.include_router(jira.router, prefix="/webhooks/jira", tags=["Jira"])
app.include_router(sentry.router, prefix="/webhooks/sentry", tags=["Sentry"])
app.include_router(github.router, prefix="/webhooks/github", tags=["GitHub"])
app.include_router(slack.router, prefix="/webhooks/slack", tags=["Slack"])


@app.get("/health")
async def health_check():
    """Health check endpoint."""
    return {"status": "healthy", "service": "webhook-server"}


@app.get("/metrics")
async def get_metrics():
    """Prometheus metrics endpoint."""
    return metrics.get_metrics()


if __name__ == "__main__":
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=settings.DEBUG)
```

---

## 8. Queue System (Redis)

### 8.1 Queue Utilities

```python
# shared/queue.py

import json
from datetime import datetime
from typing import Optional, Any
import redis.asyncio as redis


class RedisQueue:
    """Redis-based queue for task processing."""
    
    def __init__(self, redis_url: str):
        self.redis = redis.from_url(redis_url)
    
    async def push(self, queue_name: str, data: dict) -> str:
        """Push a task to the queue."""
        data["queued_at"] = datetime.utcnow().isoformat()
        
        if "task_id" not in data:
            data["task_id"] = f"task-{datetime.now().timestamp()}"
        
        await self.redis.lpush(queue_name, json.dumps(data))
        
        await self.redis.hset(
            f"tasks:{data['task_id']}", 
            mapping={"data": json.dumps(data), "status": "queued"}
        )
        
        return data["task_id"]
    
    async def pop(self, queue_name: str, timeout: int = 0) -> Optional[dict]:
        """Pop a task from the queue (blocking)."""
        result = await self.redis.brpop(queue_name, timeout=timeout)
        
        if result:
            _, data = result
            return json.loads(data)
        
        return None
    
    async def get_task(self, task_id: str) -> Optional[dict]:
        """Get task data by ID."""
        data = await self.redis.hget(f"tasks:{task_id}", "data")
        
        if data:
            return json.loads(data)
        
        return None
    
    async def update_task_status(self, task_id: str, status: str, **extra):
        """Update task status."""
        updates = {"status": status}
        updates.update(extra)
        
        await self.redis.hset(f"tasks:{task_id}", mapping={
            k: json.dumps(v) if isinstance(v, dict) else str(v)
            for k, v in updates.items()
        })
```

---

## 9. Dashboard UI

### 9.1 Next.js Application

```typescript
// services/dashboard/src/app/page.tsx

'use client';

import { useState, useEffect } from 'react';
import { TaskList } from '@/components/TaskList';
import { MetricsChart } from '@/components/MetricsChart';
import { StatusOverview } from '@/components/StatusOverview';
import { api } from '@/lib/api';
import { Task } from '@/lib/types';

export default function Dashboard() {
  const [tasks, setTasks] = useState<Task[]>([]);
  const [metrics, setMetrics] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadData();
    const interval = setInterval(loadData, 10000);
    return () => clearInterval(interval);
  }, []);

  async function loadData() {
    try {
      const [tasksData, metricsData] = await Promise.all([
        api.getTasks(),
        api.getMetrics()
      ]);
      setTasks(tasksData);
      setMetrics(metricsData);
    } catch (error) {
      console.error('Failed to load data:', error);
    } finally {
      setLoading(false);
    }
  }

  async function handleApprove(taskId: string) {
    await api.approveTask(taskId);
    loadData();
  }

  async function handleReject(taskId: string, reason: string) {
    await api.rejectTask(taskId, reason);
    loadData();
  }

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-900 flex items-center justify-center">
        <div className="text-white">Loading...</div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-900 text-white">
      <header className="bg-gray-800 border-b border-gray-700">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <h1 className="text-2xl font-bold">ğŸ¤– AI Agent Dashboard</h1>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 py-8">
        <StatusOverview tasks={tasks} />
        
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
          <MetricsChart title="Tasks by Status" type="pie" data={metrics?.tasksByStatus} />
          <MetricsChart title="Tasks Over Time" type="line" data={metrics?.tasksOverTime} />
        </div>

        <div className="mt-8">
          <TaskList
            tasks={tasks}
            onApprove={handleApprove}
            onReject={handleReject}
          />
        </div>
      </main>
    </div>
  );
}
```

---

## 10. Local Development Setup

### 10.1 Docker Compose Configuration

```yaml
# infrastructure/docker/docker-compose.yml

version: '3.8'

services:
  # Infrastructure Services
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: aiagent
      POSTGRES_PASSWORD: localdev
      POSTGRES_DB: aiagent
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U aiagent"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Application Services
  webhook-server:
    build:
      context: ../../services/webhook-server
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      - REDIS_URL=redis://redis:6379/0
      - DATABASE_URL=postgresql://aiagent:localdev@postgres:5432/aiagent
      - GITHUB_WEBHOOK_SECRET=${GITHUB_WEBHOOK_SECRET}
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
      - DEBUG=true
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy

  planning-agent:
    build:
      context: ../../agents/planning-agent
      dockerfile: Dockerfile
    environment:
      - REDIS_URL=redis://redis:6379/0
      - DATABASE_URL=postgresql://aiagent:localdev@postgres:5432/aiagent
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - SENTRY_AUTH_TOKEN=${SENTRY_AUTH_TOKEN}
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
      - SLACK_CHANNEL_AGENTS=${SLACK_CHANNEL_AGENTS:-#ai-agents}
      - CLAUDE_CONFIG_DIR=/root/.claude
    depends_on:
      redis:
        condition: service_healthy
    volumes:
      - ~/.claude:/root/.claude:ro
      - workspace:/workspace
      - /var/run/docker.sock:/var/run/docker.sock

  executor-agent:
    build:
      context: ../../agents/executor-agent
      dockerfile: Dockerfile
    environment:
      - REDIS_URL=redis://redis:6379/0
      - DATABASE_URL=postgresql://aiagent:localdev@postgres:5432/aiagent
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
      - CLAUDE_CONFIG_DIR=/root/.claude
    depends_on:
      redis:
        condition: service_healthy
    volumes:
      - ~/.claude:/root/.claude:ro
      - workspace:/workspace
      - /var/run/docker.sock:/var/run/docker.sock

  dashboard:
    build:
      context: ../../services/dashboard
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - REDIS_URL=redis://redis:6379/0
      - NEXT_PUBLIC_API_URL=http://localhost:8000
    depends_on:
      - redis
      - webhook-server

volumes:
  redis_data:
  postgres_data:
  workspace:

networks:
  default:
    name: ai-agent-network
```

### 10.2 Environment Configuration

```bash
# infrastructure/docker/.env.example

# Claude - authentication via CLI login, ~/.claude mounted into containers

# GitHub
GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
GITHUB_WEBHOOK_SECRET=your-webhook-secret

# Atlassian/Jira
JIRA_BASE_URL=https://yourcompany.atlassian.net
JIRA_EMAIL=your-email@company.com
JIRA_API_TOKEN=xxxxxxxxxxxxxxxxxxxx

# Sentry
SENTRY_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxx
SENTRY_ORG=your-org
SENTRY_HOST=sentry.io

# Slack
SLACK_BOT_TOKEN=xoxb-xxxxxxxxxxxx-xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx
SLACK_SIGNING_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SLACK_CHANNEL_AGENTS=#ai-agents
SLACK_CHANNEL_ERRORS=#ai-errors

# Database (local defaults)
DATABASE_URL=postgresql://aiagent:localdev@postgres:5432/aiagent
REDIS_URL=redis://redis:6379/0
```

### 10.3 Local Setup Script

```bash
#!/bin/bash
# scripts/setup-local.sh

set -e

echo "ğŸš€ Setting up AI Agent System locally..."

# Check prerequisites
echo "ğŸ“‹ Checking prerequisites..."

if ! command -v docker &> /dev/null; then
    echo "âŒ Docker is not installed. Please install Docker first."
    exit 1
fi

if ! command -v claude &> /dev/null; then
    echo "âš ï¸ Claude CLI is not installed. Installing..."
    npm install -g @anthropic-ai/claude-code
fi

# Check Claude authentication
if [ ! -d ~/.claude ]; then
    echo "âš ï¸ Claude CLI not authenticated. Please run 'claude login' first."
    exit 1
fi

# Setup environment
cd infrastructure/docker

if [ ! -f .env ]; then
    cp .env.example .env
    echo "ğŸ“„ Created .env file. Please edit it with your credentials."
    exit 0
fi

# Setup MCP servers
../scripts/setup-mcp.sh

# Build images
echo "ğŸ”¨ Building Docker images..."
docker-compose build

echo "âœ… Setup complete!"
echo ""
echo "To start the system:"
echo "  cd infrastructure/docker"
echo "  docker-compose up"
echo ""
echo "To access:"
echo "  - Dashboard: http://localhost:3000"
echo "  - Webhook Server: http://localhost:8000"
```

### 10.4 Run Local Script

```bash
#!/bin/bash
# scripts/run-local.sh

set -e

cd "$(dirname "$0")/../infrastructure/docker"

echo "ğŸš€ Starting AI Agent System..."

docker-compose up -d

echo "â³ Waiting for services to be ready..."
sleep 5

echo "ğŸ¥ Checking service health..."

if docker-compose exec -T redis redis-cli ping > /dev/null 2>&1; then
    echo "  âœ… Redis: healthy"
fi

if docker-compose exec -T postgres pg_isready -U aiagent > /dev/null 2>&1; then
    echo "  âœ… PostgreSQL: healthy"
fi

if curl -s http://localhost:8000/health > /dev/null; then
    echo "  âœ… Webhook Server: healthy"
fi

if curl -s http://localhost:3000 > /dev/null; then
    echo "  âœ… Dashboard: healthy"
fi

echo ""
echo "ğŸ‰ System is running!"
echo ""
echo "Access points:"
echo "  ğŸ“Š Dashboard:      http://localhost:3000"
echo "  ğŸ”— Webhook Server: http://localhost:8000"
```

---

## 11. Production Scaling

### 11.1 Scaling Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SCALING CONFIGURATION                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                   â”‚
â”‚  Component            Local Dev       Small Prod      Large Prod                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚  Planning Agent       1               1               1-2                         â”‚
â”‚  Executor Workers     1               4               8-16                        â”‚
â”‚  Webhook Server       1               2               3-5                         â”‚
â”‚  Dashboard            1               2               3                           â”‚
â”‚  Redis                1 (local)       1 (ElastiCache) Cluster                     â”‚
â”‚  PostgreSQL           1 (local)       1 (RDS)         RDS Multi-AZ               â”‚
â”‚                                                                                   â”‚
â”‚  Estimated Capacity                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚  Local Dev:           ~50 tasks/month (manual testing)                           â”‚
â”‚  Small Prod:          ~2,400 tasks/month                                          â”‚
â”‚  Large Prod:          ~9,600 tasks/month                                          â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. Kubernetes Deployment

### 12.1 Planning Agent Deployment

```yaml
# infrastructure/kubernetes/planning-agent/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: planning-agent
  namespace: ai-agent-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: planning-agent
  template:
    metadata:
      labels:
        app: planning-agent
    spec:
      containers:
        - name: planning-agent
          image: your-registry/planning-agent:latest
          resources:
            requests:
              memory: "2Gi"
              cpu: "1000m"
            limits:
              memory: "4Gi"
              cpu: "2000m"
          envFrom:
            - configMapRef:
                name: ai-agent-config
            - secretRef:
                name: ai-agent-secrets
          volumeMounts:
            - name: claude-config
              mountPath: /root/.claude
              readOnly: true
            - name: workspace
              mountPath: /workspace
      volumes:
        - name: claude-config
          secret:
            secretName: claude-config
        - name: workspace
          persistentVolumeClaim:
            claimName: workspace-pvc
```

### 12.2 Executor Agent with HPA

```yaml
# infrastructure/kubernetes/executor-agent/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: executor-agent
  namespace: ai-agent-system
spec:
  replicas: 4
  selector:
    matchLabels:
      app: executor-agent
  template:
    metadata:
      labels:
        app: executor-agent
    spec:
      containers:
        - name: executor-agent
          image: your-registry/executor-agent:latest
          resources:
            requests:
              memory: "4Gi"
              cpu: "2000m"
            limits:
              memory: "8Gi"
              cpu: "4000m"
          envFrom:
            - configMapRef:
                name: ai-agent-config
            - secretRef:
                name: ai-agent-secrets

---
# HPA for auto-scaling
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: executor-agent-hpa
  namespace: ai-agent-system
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: executor-agent
  minReplicas: 2
  maxReplicas: 8
  metrics:
    - type: External
      external:
        metric:
          name: redis_queue_length
          selector:
            matchLabels:
              queue: execution_queue
        target:
          type: AverageValue
          averageValue: "2"
```

---

## 13. AWS Infrastructure (Terraform)

### 13.1 Main Configuration

```hcl
# infrastructure/terraform/main.tf

terraform {
  required_version = ">= 1.0"
  
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = var.aws_region
  
  default_tags {
    tags = {
      Project     = "ai-agent-system"
      Environment = var.environment
      ManagedBy   = "terraform"
    }
  }
}

# VPC
module "vpc" {
  source = "./modules/vpc"
  
  name               = "ai-agent-${var.environment}"
  cidr               = var.vpc_cidr
  availability_zones = var.availability_zones
  enable_nat_gateway = true
}

# EKS Cluster
module "eks" {
  source = "./modules/eks"
  
  cluster_name    = "ai-agent-${var.environment}"
  cluster_version = "1.28"
  vpc_id          = module.vpc.vpc_id
  subnet_ids      = module.vpc.private_subnet_ids
  
  node_groups = {
    system = {
      instance_types = ["t3.medium"]
      min_size       = 2
      max_size       = 4
      desired_size   = 2
    }
    planning = {
      instance_types = ["t3.large"]
      min_size       = 1
      max_size       = 2
      desired_size   = 1
    }
    executor = {
      instance_types = ["t3.xlarge"]
      min_size       = 2
      max_size       = 8
      desired_size   = 4
    }
  }
}

# RDS PostgreSQL
module "rds" {
  source = "./modules/rds"
  
  identifier     = "ai-agent-${var.environment}"
  engine         = "postgres"
  engine_version = "15"
  instance_class = var.environment == "prod" ? "db.t3.medium" : "db.t3.small"
  vpc_id         = module.vpc.vpc_id
  subnet_ids     = module.vpc.private_subnet_ids
}

# ElastiCache Redis
module "elasticache" {
  source = "./modules/elasticache"
  
  cluster_id      = "ai-agent-${var.environment}"
  engine          = "redis"
  engine_version  = "7.0"
  node_type       = "cache.t3.small"
  vpc_id          = module.vpc.vpc_id
  subnet_ids      = module.vpc.private_subnet_ids
}

# EFS for shared workspace
module "efs" {
  source = "./modules/efs"
  
  name       = "ai-agent-workspace-${var.environment}"
  vpc_id     = module.vpc.vpc_id
  subnet_ids = module.vpc.private_subnet_ids
}
```

---

## 14. Slack Integration

### 14.1 Slack Commands

| Command | Action |
|---------|--------|
| `/agent status <task-id>` | Get task status |
| `/agent approve <task-id>` | Approve plan for execution |
| `/agent reject <task-id> [reason]` | Reject plan |
| `/agent retry <task-id>` | Retry failed task |
| `/agent list [status]` | List tasks |
| `/agent run <description>` | Manually trigger a task |
| `/agent help` | Show help |

---

## 15. Monitoring & Observability

### 15.1 Prometheus Metrics

```python
# shared/metrics.py

from prometheus_client import Counter, Histogram, Gauge, generate_latest

tasks_started = Counter('ai_agent_tasks_started_total', 'Total tasks started', ['agent'])
tasks_completed = Counter('ai_agent_tasks_completed_total', 'Total tasks completed', ['agent', 'status'])
task_duration = Histogram('ai_agent_task_duration_seconds', 'Task duration', ['agent', 'status'])
queue_length = Gauge('ai_agent_queue_length', 'Queue length', ['queue_name'])
errors_total = Counter('ai_agent_errors_total', 'Total errors', ['agent', 'error_type'])

def get_metrics():
    return generate_latest().decode('utf-8')
```

---

## 16. Cost Analysis

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           COST ANALYSIS                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                   â”‚
â”‚  COMPONENT                    LOCAL DEV      SMALL PROD      LARGE PROD          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                                                                   â”‚
â”‚  Claude Teams Seats                                                               â”‚
â”‚  â”œâ”€ Planning Agent            $0 (dev)       $150            $300 (2)            â”‚
â”‚  â”œâ”€ Executor Workers          $0 (dev)       $600 (4)        $1,500 (10)         â”‚
â”‚  â””â”€ Subtotal                  $0             $750            $1,800              â”‚
â”‚                                                                                   â”‚
â”‚  AWS Infrastructure                                                               â”‚
â”‚  â”œâ”€ EKS Cluster               $0             $73             $73                 â”‚
â”‚  â”œâ”€ EC2 (Node Groups)         $0             $250            $800                â”‚
â”‚  â”œâ”€ RDS PostgreSQL            $0             $50             $150                â”‚
â”‚  â”œâ”€ ElastiCache Redis         $0             $25             $75                 â”‚
â”‚  â”œâ”€ EFS Storage               $0             $10             $30                 â”‚
â”‚  â”œâ”€ ALB                       $0             $20             $40                 â”‚
â”‚  â””â”€ Subtotal                  $0             $428            $1,168              â”‚
â”‚                                                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•           â”‚
â”‚  TOTAL MONTHLY                $0             ~$1,550         ~$3,900             â”‚
â”‚                                                                                   â”‚
â”‚  ROI (50 developers, 60% success rate)                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚  â”‚ Hours saved/month          â”‚ 1,125 hours                                      â”‚
â”‚  â”‚ Monthly savings            â”‚ $67,500                                          â”‚
â”‚  â”‚ ROI                        â”‚ 4,254%                                           â”‚
â”‚  â”‚ Break-even                 â”‚ 11 bugs/month                                    â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 17. Implementation Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          IMPLEMENTATION TIMELINE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                   â”‚
â”‚  PHASE 1: LOCAL DEVELOPMENT (Week 1-2)                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•            â”‚
â”‚  â”‚ Day 1-2   â”‚ Project structure, Docker Compose, base services                 â”‚
â”‚  â”‚ Day 3-4   â”‚ MCP configuration, Claude Code integration                        â”‚
â”‚  â”‚ Day 5-7   â”‚ Planning Agent with skills                                        â”‚
â”‚  â”‚ Day 8-10  â”‚ Executor Agent with skills, Dashboard UI                          â”‚
â”‚  â”‚           â”‚ âœ… Milestone: Local system fully functional                       â”‚
â”‚                                                                                   â”‚
â”‚  PHASE 2: INTEGRATION (Week 3)                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•            â”‚
â”‚  â”‚ Day 1-3   â”‚ Sentry, Jira, GitHub webhook integration                          â”‚
â”‚  â”‚ Day 4-5   â”‚ Slack Agent & commands                                            â”‚
â”‚  â”‚ Day 6-7   â”‚ End-to-end testing locally                                        â”‚
â”‚  â”‚           â”‚ âœ… Milestone: All integrations working locally                    â”‚
â”‚                                                                                   â”‚
â”‚  PHASE 3: PRODUCTION (Week 4-5)                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•            â”‚
â”‚  â”‚ Day 1-3   â”‚ Terraform modules (VPC, EKS, RDS, ElastiCache)                    â”‚
â”‚  â”‚ Day 4-5   â”‚ Kubernetes manifests, CI/CD pipeline                              â”‚
â”‚  â”‚ Day 6-10  â”‚ Deploy to staging, monitoring setup                               â”‚
â”‚  â”‚           â”‚ âœ… Milestone: Staging environment running                         â”‚
â”‚                                                                                   â”‚
â”‚  PHASE 4: PILOT (Week 6-8)                                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•            â”‚
â”‚  â”‚ Week 6    â”‚ Pilot with 5 developers                                           â”‚
â”‚  â”‚ Week 7    â”‚ Feedback collection, bug fixes                                    â”‚
â”‚  â”‚ Week 8    â”‚ Expand to 15 developers                                           â”‚
â”‚  â”‚           â”‚ âœ… Milestone: Validated in production                             â”‚
â”‚                                                                                   â”‚
â”‚  PHASE 5: FULL ROLLOUT (Week 9-12)                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•            â”‚
â”‚  â”‚ Week 9-10 â”‚ Expand to 30-50 developers                                        â”‚
â”‚  â”‚ Week 11-12â”‚ Monitoring, optimization, documentation                           â”‚
â”‚  â”‚           â”‚ âœ… Milestone: Full production deployment                          â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 18. Makefile Commands

```makefile
# Makefile

.PHONY: help setup local up down logs test deploy

help:
	@echo "AI Agent System Commands"
	@echo ""
	@echo "Local Development:"
	@echo "  make setup    - Initial setup"
	@echo "  make local    - Start local environment"
	@echo "  make up       - Start all services"
	@echo "  make down     - Stop all services"
	@echo "  make logs     - View logs"
	@echo "  make test     - Run tests"
	@echo ""
	@echo "Production:"
	@echo "  make deploy   - Deploy to production"
	@echo "  make plan     - Terraform plan"
	@echo "  make apply    - Terraform apply"

setup:
	./scripts/setup-local.sh

local:
	./scripts/run-local.sh

up:
	cd infrastructure/docker && docker-compose up -d

down:
	cd infrastructure/docker && docker-compose down

logs:
	cd infrastructure/docker && docker-compose logs -f

test:
	pytest tests/ -v

trigger:
	./scripts/trigger-task.sh "$(DESC)" "$(REPO)"

deploy:
	./scripts/deploy.sh

plan:
	cd infrastructure/terraform && terraform plan

apply:
	cd infrastructure/terraform && terraform apply
```

---

## 19. Summary

### 19.1 Architecture Summary

| Component | Local Development | Production |
|-----------|-------------------|------------|
| **Planning Agent** | 1 container | 1 pod (EC2 t3.large) |
| **Executor Workers** | 1 container | 4 pods (t3.xlarge), auto-scaling 2-8 |
| **Webhook Server** | 1 container | 2 pods (with ALB) |
| **Dashboard** | 1 container | 2 pods |
| **Redis** | Docker container | ElastiCache |
| **PostgreSQL** | Docker container | RDS |

### 19.2 Key Features

| Feature | Description |
|---------|-------------|
| **Two-Agent Architecture** | Planning (discovery + plan) + Executor (TDD implementation) |
| **Official MCP Servers** | GitHub, Atlassian (Jira), Sentry, Filesystem |
| **Skills System** | Modular skills for each agent capability |
| **Human-in-the-Loop** | Mandatory approval before code execution |
| **Local-First** | Complete system runs locally before cloud |
| **Dashboard UI** | Real-time task monitoring and control |
| **Slack Integration** | Commands and notifications |
| **Auto-Scaling** | Executor workers scale based on queue |

### 19.3 Flow Summary

```
Trigger (Sentry/Jira/Slack/Manual)
    â”‚
    â–¼
Webhook Server â†’ Redis (planning_queue)
    â”‚
    â–¼
Planning Agent
    â”œâ”€ Discovery (identify repo + files)
    â”œâ”€ Planning (create TDD plan)
    â””â”€ Request Approval (GitHub PR + Slack)
    â”‚
    â–¼
Human Approval (GitHub/Slack/Dashboard)
    â”‚
    â–¼
Redis (execution_queue)
    â”‚
    â–¼
Executor Agent (any free worker)
    â”œâ”€ TDD cycle (RED â†’ GREEN â†’ REFACTOR)
    â””â”€ Commit + Push + Update PR
    â”‚
    â–¼
Completion (Slack + Jira + Metrics)
```

### 19.4 Getting Started

```bash
# 1. Clone the repository
git clone https://github.com/your-org/ai-agent-system.git
cd ai-agent-system

# 2. Run setup
make setup

# 3. Configure environment
cp infrastructure/docker/.env.example infrastructure/docker/.env
# Edit .env with your credentials

# 4. Authenticate Claude CLI
claude login

# 5. Start locally
make local

# 6. Access dashboard
open http://localhost:3000

# 7. Trigger a test task
make trigger DESC="Test error: NullPointerException"
```

---

*Document Version: 4.0 - Production-Ready with Local-First Development*
*Based on: Claude Code CLI POC Architecture*
*Last Updated: January 2026*
