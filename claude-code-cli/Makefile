.PHONY: help setup env up down logs test clean ngrok

help:
	@echo "AI Agent System - Claude Code CLI"
	@echo ""
	@echo "Available commands:"
	@echo "  make setup    - Initial setup (install dependencies)"
	@echo "  make env      - Edit environment variables (.env)"
	@echo "  make up       - Start all services"
	@echo "  make down     - Stop all services"
	@echo "  make logs     - View logs"
	@echo "  make test     - Run tests"
	@echo "  make clean    - Clean up volumes and images"
	@echo "  make ngrok    - Expose webhook server to the internet via ngrok"
	@echo ""

env:
	@test -f infrastructure/docker/.env || { echo "Creating .env from example..."; cp infrastructure/docker/.env.example infrastructure/docker/.env; }
	nano infrastructure/docker/.env

setup:
	@echo "ğŸ”§ Setting up Claude Code CLI system..."
	@command -v docker >/dev/null 2>&1 || { echo "âŒ Docker not installed"; exit 1; }
	@command -v claude >/dev/null 2>&1 || { echo "âš ï¸  Claude CLI not found, installing..."; npm install -g @anthropic-ai/claude-code; }
	@test -d ~/.claude || { echo "âŒ Claude not authenticated. Run 'claude login' first"; exit 1; }
	@echo "âœ… Prerequisites OK"
	@echo "ğŸ“„ Checking environment file..."
	@test -f infrastructure/docker/.env || { echo "Creating .env from example..."; cp infrastructure/docker/.env.example infrastructure/docker/.env; echo "âš ï¸  Please edit infrastructure/docker/.env with your credentials"; exit 0; }
	@echo "âœ… Setup complete!"

up:
	@echo "ğŸš€ Starting AI Agent System..."
	cd infrastructure/docker && docker-compose up -d
	@echo "â³ Waiting for services to start..."
	@sleep 10
	@echo ""
	@echo "âœ… System is running!"
	@echo ""
	@echo "ğŸ“Š Dashboard:      http://localhost:3000 (not yet implemented)"
	@echo "ğŸ”— Webhook Server: http://localhost:8000"
	@echo "ğŸ“ˆ Metrics:        http://localhost:8000/metrics"
	@echo ""
	@echo "View logs with: make logs"

down:
	@echo "ğŸ›‘ Stopping AI Agent System..."
	cd infrastructure/docker && docker-compose down
	@echo "âœ… System stopped"

logs:
	@cd infrastructure/docker && docker-compose logs -f

test:
	@echo "ğŸ§ª Running tests..."
	pytest tests/ -v

clean:
	@echo "ğŸ§¹ Cleaning up..."
	cd infrastructure/docker && docker-compose down -v
	@echo "âœ… Cleaned up volumes"

ngrok:
	@echo "ğŸŒ Exposing port 8000 via ngrok..."
	ngrok http 8000

