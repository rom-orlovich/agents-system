# Slack Webhook Configuration
# ===========================
# This file configures how the agent responds to Slack events.
# Edit this file to customize commands, triggers, and behavior.

name: slack
description: Slack webhook for commands and mentions
endpoint: /webhooks/slack
source: slack

# Agent Trigger Configuration
# ---------------------------
# These are the prefixes that trigger the agent to respond.
agent_trigger:
  prefix: "@agent"
  aliases:
    - "@claude"
    - "@bot"
    - "@ai-agent"

# Default agent for routing tasks
target_agent: brain

# Default command when no specific command is detected
default_command: analyze

# Security Configuration
# ----------------------
security:
  requires_signature: true
  signature_header: X-Slack-Signature
  secret_env_var: SLACK_WEBHOOK_SECRET

# Commands Configuration
# ----------------------
commands:
  - name: help
    aliases:
      - commands
      - what-can-you-do
    description: Show available commands
    target_agent: brain
    requires_approval: false
    prompt_template: |
      User asked for help in Slack.

      **User Request:** {{_user_content}}

      **Full Message:**
      {{event.text}}

      User: {{event.user}}
      Channel: {{event.channel}}

      1. Generate help message with available commands.
      2. Save to file.
      3. Post response back to Slack:
         python .claude/skills/slack-operations/scripts/post_message.py {{event.channel}} help.md {{event.ts}}

  - name: analyze
    aliases:
      - analysis
    description: Analyze a request from Slack
    target_agent: brain
    requires_approval: false
    prompt_template: |
      Analyze this Slack message:

      **User Request:** {{_user_content}}

      **Full Message:**
      {{event.text}}

      User: {{event.user}}
      Channel: {{event.channel}}

      1. Perform analysis.
      2. Save to file.
      3. Post response back to Slack:
         python .claude/skills/slack-operations/scripts/post_message.py {{event.channel}} analysis.md {{event.ts}}

  - name: execute
    aliases:
      - do
      - run
    description: Execute a command from Slack
    target_agent: executor
    requires_approval: true
    prompt_template: |
      Execute this request from Slack:

      **User Request:** {{_user_content}}

      **Full Message:**
      {{event.text}}

      User: {{event.user}}
      Channel: {{event.channel}}

      1. Execute request.
      2. Save result/summary to file.
      3. Post response back to Slack:
         python .claude/skills/slack-operations/scripts/post_message.py {{event.channel}} result.md {{event.ts}}

  - name: jira
    aliases:
      - ticket
      - jira-ticket
      - query-jira
    description: Query Jira ticket context, status, and details
    target_agent: slack-inquiry
    requires_approval: false
    prompt_template: |
      Query Jira ticket information from Slack.

      **User Request:** {{_user_content}}

      **Full Message:**
      {{event.text}}

      User: {{event.user}}
      Channel: {{event.channel}}

      1. Extract ticket key(s) from the user's message (e.g., PROJ-123, TASK-456).
      2. Use jira-operations skill to fetch ticket details:
         - Status, assignee, summary, description
         - Comments, attachments, linked issues
         - Sprint/board information if available
      3. Format response with ticket information.
      4. Post response back to Slack:
         python .claude/skills/slack-operations/scripts/post_message.py {{event.channel}} jira_query.md {{event.ts}}

  - name: discover
    aliases:
      - code
      - explore
      - find-code
      - code-insights
    description: Discover GitHub code, get insights about codebase
    target_agent: slack-inquiry
    requires_approval: false
    prompt_template: |
      Discover code and provide insights from Slack.

      **User Request:** {{_user_content}}

      **Full Message:**
      {{event.text}}

      User: {{event.user}}
      Channel: {{event.channel}}

      1. Parse the user's query to understand what code they want to discover:
         - Function/class names
         - File paths or patterns
         - Feature/functionality descriptions
         - Code relationships or dependencies
      2. Use discovery skill to search and analyze codebase:
         - Find relevant files and functions
         - Understand code flow and relationships
         - Extract code snippets and examples
         - Identify dependencies and usage patterns
      3. Format insights with code snippets, file paths, and explanations.
      4. Post response back to Slack:
         python .claude/skills/slack-operations/scripts/post_message.py {{event.channel}} code_discovery.md {{event.ts}}

  - name: status
    aliases:
      - check
      - task-status
    description: Check status of ongoing tasks
    target_agent: brain
    requires_approval: false
    prompt_template: |
      User is checking task status from Slack.

      **User Request:** {{_user_content}}

      **Full Message:**
      {{event.text}}

      User: {{event.user}}
      Channel: {{event.channel}}

      1. Check for any running or recent tasks.
      2. Provide status update.
      3. Post response back to Slack:
         python .claude/skills/slack-operations/scripts/post_message.py {{event.channel}} status.md {{event.ts}}

  - name: approve
    aliases:
      - lgtm
      - approved
      - yes
    description: Approve a pending action
    target_agent: executor
    requires_approval: false
    prompt_template: |
      Approval received from Slack.

      **User Comment:** {{_user_content}}

      **Full Message:**
      {{event.text}}

      User: {{event.user}}
      Channel: {{event.channel}}

      1. Process the approval.
      2. Proceed with the pending action if applicable.
      3. Post confirmation back to Slack:
         python .claude/skills/slack-operations/scripts/post_message.py {{event.channel}} confirmation.md {{event.ts}}

  - name: reject
    aliases:
      - no
      - cancel
      - stop
    description: Reject or cancel a pending action
    target_agent: brain
    requires_approval: false
    prompt_template: |
      Rejection/cancellation received from Slack.

      **User Comment:** {{_user_content}}

      **Full Message:**
      {{event.text}}

      User: {{event.user}}
      Channel: {{event.channel}}

      1. Process the rejection.
      2. Cancel any pending actions.
      3. Post confirmation back to Slack:
         python .claude/skills/slack-operations/scripts/post_message.py {{event.channel}} cancelled.md {{event.ts}}
